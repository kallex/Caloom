<?xml version="1.0" encoding="utf-8"?>
<TheBallCoreAbstraction xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="TheBallCore_v1_0.xsd">
  <InstanceOfTheBall semanticDomainName="TheBall.Interface">
    <InformationModel>
      <InformationObject name="StatusSummary" serializationType="Binary" designDesc="Status summary object" provideCreateMethod="false">
        <InformationItems>
          <InformationItem name="PendingOperations" logicalDataType="InformationObject" informationObjectName="OperationExecutionItem" isCollection="true"/>
          <InformationItem name="ExecutingOperations" logicalDataType="InformationObject" informationObjectName="OperationExecutionItem" isCollection="true"/>
          <InformationItem name="RecentCompletedOperations" logicalDataType="InformationObject" informationObjectName="OperationExecutionItem" isCollection="true"/>
          <InformationItem name="RecentChangeItemIDs" logicalDataType="Text_Short" isCollection="true" />
        </InformationItems>
      </InformationObject>
      <InformationObject name="InformationChangeItem" designDesc="Item that describes information object change. ID is guid prefixed with UTC timerange." provideCreateMethod="false" serializationType="Binary">
        <InformationItems>
          <InformationItem name="StartTimeUTC" logicalDataType="Time_DateTime"/>
          <InformationItem name="EndTimeUTC" logicalDataType="Time_DateTime"/>
          <InformationItem name="ChangedObjectIDList" logicalDataType="Text_Short" isCollection="true"/>
        </InformationItems>
      </InformationObject>
      <InformationObject name="OperationExecutionItem" designDesc="Operation execution item">
        <InformationItems>
          <InformationItem name="OperationName" logicalDataType="Text_Short"/>
          <InformationItem name="OperationDomain" logicalDataType="Text_Short"/>
          <InformationItem name="OperationID" logicalDataType="Text_Short"/>
          <InformationItem name="CallerProvidedInfo" logicalDataType="Text_Short"/>
          <InformationItem name="CreationTime" logicalDataType="Time_DateTime"/>
          <InformationItem name="ExecutionBeginTime" logicalDataType="Time_DateTime"/>
          <InformationItem name="ExecutionCompletedTime" logicalDataType="Time_DateTime"/>
          <InformationItem name="ExecutionStatus" logicalDataType="Text_Short"/>          
        </InformationItems>
      </InformationObject>
    </InformationModel>
    <Operations>
      <Operation name="ExecuteOperation">
        <OperationSpec>
          <Description>Execute given operation</Description>
        </OperationSpec>
        <Parameters>
          <Parameter name="OwnerLocation" dataType="string" designDesc="Owner location of the operation context" state="designApproved"/>
          <Parameter name="OperationDomain" dataType="string" designDesc="Operation namespace" state="designApproved"/>
          <Parameter name="OperationName" dataType="string" designDesc="Operation name" state="designApproved"/>
          <Parameter name="OperationParameters" dataType="byte[]" designDesc="Operation parameters binary serialized." state="designApproved"/>
          <Parameter name="CallerProvidedInfo" dataType="string" designDesc="Caller provided information about the call. For caller specific purposes."/>
        </Parameters>
        <Execution>
          <SequentialExecution />
        </Execution>
      </Operation>
      <Operation name="UpdateStatusSummary">
        <OperationSpec>
          <Description>Updates status summary for given owner, based on changed ID lists and time range.</Description>
        </OperationSpec>
        <Parameters>
          <Parameter name="Owner" dataType="TheBall.CORE.IContainerOwner" designDesc="Owner of the operation context" state="implemented"/>
          <Parameter name="StartTime" dataType="DateTime" designDesc="Starting time of changes updated in this cycle" state="implemented"/>
          <Parameter name="EndTime" dataType="DateTime" designDesc="Ending time of changes updated in this cycle" state="implemented"/>
          <Parameter name="ChangedIDList" dataType="string[]" designDesc="Changed ID list on this cycle" state="implemented"/>
          <Parameter name="RemoveExpiredEntriesSeconds" dataType="int" designDesc="Remove entries older than amount of seconds given here" state="implemented"/>
        </Parameters>
        <Execution>
          <SequentialExecution>
            <TargetDefinition name="ChangeItem" dataType="InformationChangeItem" designDesc="Change item registering the ID changed list. NOTE! ID is of form UTCStart_UTCEnd_GUID" state="implemented">
              <Parameter name="Owner"/>
              <Parameter name="StartTime"/>
              <Parameter name="EndTime"/>
              <Parameter name="ChangedIDList"/>
            </TargetDefinition>
            <MethodExecute name="StoreObject" designDesc="Store changeitem" state="implemented">
              <Target name="ChangeItem"/>
            </MethodExecute>
            <MethodExecute name="EnsureUpdateOnStatusSummary" designDesc="Guarantee update on StatusSummary, retry if fails. Sort the RecentChangeItemIDs to ID order, remove expired entries" state="implemented">
              <Parameter name="Owner"/>
              <Parameter name="RemoveExpiredEntriesSeconds"/>
              <Target name="ChangeItem"/>
              <ReturnValue name="ExpiredEntryIDs" dataType="string[]" designDesc="Expired entries based on expiration time" state="implemented"/>
            </MethodExecute>
            <MethodExecute name="RemoveExpiredEntries" designDesc="Remove expired changeitem entries" state="implemented">
              <Parameter name="Owner"/>
              <Target name="EnsureUpdateOnStatusSummaryOutput"/>
            </MethodExecute>
          </SequentialExecution>
        </Execution>
      </Operation>
    </Operations>
    <Subscriptions />
  </InstanceOfTheBall>
</TheBallCoreAbstraction>